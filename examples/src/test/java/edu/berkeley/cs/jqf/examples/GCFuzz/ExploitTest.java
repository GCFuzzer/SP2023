package edu.berkeley.cs.jqf.examples.GCFuzz;

import com.pholser.junit.quickcheck.From;
import edu.berkeley.cs.jqf.examples.GadgetChain.ExploitGenerator;
import edu.berkeley.cs.jqf.examples.common.Dictionary;
import edu.berkeley.cs.jqf.fuzz.Fuzz;
import edu.berkeley.cs.jqf.fuzz.JQF;
import org.junit.runner.RunWith;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

@RunWith(JQF.class)
public class ExploitTest {

    @Fuzz
    public void testWithGenerator(@From(ExploitGenerator.class) @Dictionary("dictionaries/CUT.dict") Object exploit) throws Exception {
        ByteArrayOutputStream barr = new ByteArrayOutputStream();
        ObjectOutputStream oos = new ObjectOutputStream(barr);
        oos.writeObject(exploit);
        oos.close();
        ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray()));
        ois.readObject();
    }
}